# Migros Security Advisory
This is a security advisory published by the Security Operations / Cyber Defense Center team of MGB (Migros-Genossenschafts-Bund) found during penetration tests or red team engagements.

## Odoo 15 (and possibly earlier) - Authenticated account takeover
| Key | Value |
| --- | --- |
| Vendor | Odoo |
| Product | Odoo |
| Vulnerability | Read access to OAuth access tokens and account takeover |
| Affected Versions | 15 |
| URL | [https://www.odoo.com/](https://www.odoo.com/) |
| CVSS 4.0 | 8.7 |
| CWE | CWE-200 |
| CAPEC | CAPEC-87, CAPEC-233 |
| MSEC ID | MSEC-2025-002 |
| Vendor ID | ODOO-SA-2024-12-23 |
| CVE ID | CVE-2024-12368 |

## Table of Contents
1. Summary
2. Details
3. Workaround and Fix
4. Credits
5. Timeline
6. References
7. About Us
8. Disclaimer

## 1. Summary
Improper access control in the auth_oauth module of `Odoo Community 15.0` and `Odoo Enterprise 15.0` allows an internal user to export the OAuth tokens of other users. Non-privileged users can access other users' OAuth access tokens in `Odoo 15` (and possibly earlier) by using the Export feature of Odoo. They can then use these looted OAuth access tokens to log into the user accounts that the token belongs to.
This vulnerability allows for horizontal and vertical privilege escalation.


## 2. Details
It is possible for regular users (i.e. users that neither have `Admin=Access rights` nor `Admin=Settings` set) to dump the OAuth access tokens of all other users using the `Export` feature. Thus, the only prerequirements to this attack are that a) an account on an Odoo instance/installation is present, and b) that the `Export` feature is enabled (which it is for all users by default after user account creation). The OAuth access token is present as a field in the User base model. As Odoo uses the `OAuth 2.0 Implicit Flow/Grant` for OAuth-supported login, it is thus possible to impersonate other users by passing their access tokens to the authentication endpoint at `/auth_oauth/signin` after dumping them. This allows any party with a user account on an `Odoo 15` (and possibly earlier, as long as OAuth login is supported) instance to impersonate any other user that uses OAuth for authentication. As the OAuth access tokens in the database often have a short expiration period, an attacker can either impersonate only recently authenticated users, or may repeatedly dump the User model through the `Export` feature until a valuable user's (e.g. an administrator's) recent OAuth access token appears in it, or may trick a valuable user into logging into the instance through social engineering and then dump their OAuth access token. While the User model list view is not shown to regular users (as it is usually in the Settings app, which is also not shown to non-administrator users), it is possible to reach it via deep browsing to the User model list view. If said list view's link is not known to an attacker, it can be easily guessed by iterating through numerical IDs called `action`. For example, the following is a valid link to the User model list view on an Odoo instance: `https://67085569-15-0-all.runbot183.odoo.com/web#cids=1&menu_id=4&action=72&model=res.users&view_type=list`, where the action would need to be guessed. In our tests it was usually between `1` and `100`. After dumping the OAuth access tokens using the Export feature on the User model list view, other users' accounts can then be taken over by passing a still-valid OAuth access token to the OAuth login endpoint at `/auth_oauth/signin`.


## 3. Workaround and Fix
The following chapter describes how the reported vulnerability can be mitigated (e.g., using a workaround) and if available sustainably fixed.
### Workaround
Disable OAuth login for your Odoo installation and/or all users.


### Fix
- Do not allow the OAuth Implicit Flow for login. Use something that is more secure.
- Protect the OAuth Access Token field in all affected versions against being read, also during export.
- Consider not storing the OAuth Access Token at all after successful authentication, if possible.



## 4. Credits
- Rafael Fedler, Migros-Genossenschafts-Bund (MGB)

## 5. Timeline
| Date | Process | Comments |
| --- | --- | --- |
| 16.08.2024 | Vulnerability Discovery | None |
| 20.08.2024 | Vendor Notification | None |
| 20.08.2024 | Vendor Receipt | None |
| 20.08.2024 | Vendor Validation | None |
| 20.08.2024 | Vendor Resolution | Vendor creates patch in GitHub code base as pull request 177259. |
| 23.12.2024 | Vendor Resolution | Security advisory (ODOO-SA-2024-12-23) published by vendor to subscribers. |
| 15.01.2025 | Vendor Resolution | Security advisory published by vendor to public through GitHub as issue 193854. |
| 25.02.2025 | Vendor Resolution | CVE published as CVE-2024-12368. |
| 20.05.2025 | Advisory Release | This advisory (MSEC-2025-002) published by Migros-Genossenschafts-Bund (MGB). |

## 6. References
- [https://github.com/migros/migros-security-advisories/](https://github.com/migros/migros-security-advisories/)
- [https://www.odoo.com/](https://www.odoo.com/)

## 7. About Us
The MGB (Migros-Genossenschafts-Bund) is the central service company of the Migros Group and offers around 350 different functions. For this reason, we are always on the lookout for specialists from a wide range of fields. You can find us on [jobs.migros.ch](https://migros-gruppe.jobs/de/unsere-unternehmen/migros-gruppe/offene-stellen?q=cyber).


## 8. Disclaimer
The MGB (Migros-Genossenschafts-Bund) works with suppliers to mitigate identified vulnerabilities as best as possible. The publication of vulnerabilities without the availability of a suitable corrective measure (patch) is not the goal of the MGB. The full disclosure of a vulnerability is only used by MGB in exceptional cases. The protection of the Migros community, especially those who are in a contractual relationship, must be guaranteed in any case and MGB will act in their interests.


